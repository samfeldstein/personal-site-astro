---
import Base from "@layouts/Base.astro";
import Head from "@components/Head.astro";
import "/src/styles/_resume.scss";
import "/src/styles/_resume-print.scss";

import { getCollection } from "astro:content";

// Import resume sections
import {
  workHistory,
  projects,
  publications,
  volunteer,
  education,
} from "../../data/resume.js";

export async function getStaticPaths() {
  const entries = await getCollection("resumes");
  return entries.map((entry) => ({
    params: { id: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;

const description = `Sam Feldstein's ${entry.data.title} résumé.`;
const preloadFonts = ["cormorant", "noto-sans"];

// Convert relevant keys into an array of job objects
const relevantExperience = entry.data.relevantExperience.map(
  (key) => workHistory[key] || {},
);

// Convert relevant keys into an array of job objects
const otherExperience = entry.data.otherExperience.map(
  (key) => workHistory[key],
);

const projectsData = entry.data.projects?.map((key) => projects[key] || []);

const relevantVolunteerData = entry.data.volunteer.map(
  (key) => volunteer[key] || {},
);
const publicationsData = entry.data.publications?.map(
  (key) => publications[key] || [],
);
---

<Base>
  <Head
    slot="head"
    title=`${entry.data.title} Résumé`
    description={description}
    preloadFonts={preloadFonts}
  />
  <header>
    <!-- <address class="print">
      <div class="city">Boulder, CO</div>
      <a href="mailto:sam@samfeldstein.xyz">sam@samfeldstein.xyz</a>
    </address> -->
    <a
      class="download-link"
      href=`/static/resumes/sam-feldstein-${entry.data.printUrl}-resume.pdf`
      target="_blank">Download PDF</a
    >
    <h1>
      <span class="name">Samuel Feldstein</span>
      <span class="role">{entry.data.title}</span>
    </h1>

    <div class="address-grid-container">
      <address>
        <span class="location">Boulder, CO</span>
        <a href="tel:5156572243">(515) 657-2243</a>
        <a href="mailto:sam@samfeldstein.xyz">sam@samfeldstein.xyz</a>
        <a class="no-print" href="/">Website</a>
        {
          entry.data.links.map((link) => (
            <a class="no-print" href={link.url}>
              {link.name}
            </a>
          ))
        }
      </address>
    </div>

    {entry.data.summary && <p class="summary">{entry.data.summary}</p>}

    <nav class="contents">
      <div>
        <a href="#skills">Skills</a>
        <a href="#relevant-experience">Experience</a>
        <a href="#projects">Projects</a>
      </div>
      <div>
        <a href="#volunteer">Volunteer</a>
        <a href="#publications">Publications</a>
        <a href="#education">Education</a>
      </div>
    </nav>
  </header>
  <main id="main-content">
    <section id="skills">
      <h2>Skills</h2>
      <div class="skills">
        {
          entry.data.skills.map(({ category, items }) => (
            <section>
              <h3>{category}</h3>
              <ul class="skills">
                {items.map((skill) => (
                  <li>{skill}</li>
                ))}
              </ul>
            </section>
          ))
        }
      </div>
    </section>

    <section id="relevant-experience">
      <h2>{entry.data.experienceKey} Experience</h2>
      <div class="relevant-experience">
        {
          relevantExperience?.map((job) => (
            <article>
              <h3>
                {job.role} {job.employer && `@ ${job.employer}`}
              </h3>
              <div class="info">
                <span>{job.date}</span> | {job.place}
              </div>
              <ul>
                {job.description?.map((point) => (
                  // Renders html in the object values
                  <li set:html={point} />
                ))}
              </ul>
            </article>
          ))
        }
      </div>
    </section>

    <section id="other-experience">
      <h2>Other Experience</h2>
      <div class="other-experience">
        {
          otherExperience?.map((job) => (
            <article>
              <h3>
                {job.role} {job.employer && `@ ${job.employer}`}
              </h3>
              <div class="info">
                <span>{job.date}</span> | {job.place}
              </div>
              <ul>
                {job.description?.map((point) => (
                  // Renders html in the object values
                  <li set:html={point} />
                ))}
              </ul>
            </article>
          ))
        }
      </div>
    </section>

    {
      projectsData && (
        <section id="projects" class="projects">
          <h2>Selected Projects</h2>
          <div class="projects">
            {projectsData?.map((project) => (
              <article>
                <h3>{project.title}</h3>
                <div class="info">
                  <span>{project.type}</span> | <span>{project.date}</span>
                </div>
                <p class="project-description">{project.description}</p>
                {/* <ul class="projects">
                {project.description?.map((point) => (
                  <li set:html={point} />
                ))}
              </ul> */}
              </article>
            ))}
          </div>
        </section>
      )
    }

    <section id="volunteer">
      <h2>Volunteer</h2>
      <div class="volunteer">
        {
          relevantVolunteerData?.map((entry) => (
            <article>
              <h3>
                {entry.role} {entry.employer && `@ ${entry.employer}`}
              </h3>
              <div class="info">
                <span>{entry.date}</span> {entry.place && `| ${entry.place}`}
              </div>
              <p>{entry.description}</p>
            </article>
          ))
        }
      </div>
    </section>

    <section id="publications">
      <h2>Publications</h2>
      <ul class="publications">
        {
          publicationsData.map((pub) => (
            <li>
              <cite class="publication h3" set:html={pub.title} />
              <div class="info">
                {pub.medium} | <cite>{pub.outlet}</cite> |{" "}
                <span>{pub.date}</span>
              </div>
            </li>
          ))
        }
      </ul>
    </section>

    <section id="education">
      <h2>Education</h2>
      <div class="education">
        {
          education.map((entry) => (
            <article>
              <h3>{entry.school}</h3>
              <div class="info">
                {entry.city} | <span>{entry.date}</span>
              </div>
              <ul>
                <li set:html={entry.degree} />
              </ul>
            </article>
          ))
        }
      </div>
    </section>
  </main>
  <script>
    // Set --vh to the initial viewport height and don't update it. Prevent layout shift from 100vh on mobile
    const header = document.querySelector("header");

    if (header) {
      header.style.setProperty(
        "--vh",
        `${document.documentElement.clientHeight}px`,
      );
    }

    // See https://developer.mozilla.org/en-US/docs/Web/API/Element/clientHeight
  </script>
</Base>
